<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A professional, client-side tool for writing and previewing HTML code in real-time.">
  <title>HTML Pro Editor</title>
  
  <!-- CodeMirror CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/monokai.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/dialog/dialog.min.css">

  <style>
    :root {
      --header-bg: #f0f0f0;
      --border-color: #d1d1d1;
      --text-color: #333;
      --button-bg: #fff;
      --button-hover-bg: #e9e9e9;
      --accent-color: #0078d4;
      --font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
    }

    html, body {
      height: 100%;
      padding: 0;
      margin: 0;
      font-family: var(--font-family);
      color: var(--text-color);
      overflow: hidden;
    }

    body {
      display: flex;
      flex-direction: column;
      background-color: #f8f9fa;
    }

    header, footer {
      flex-shrink: 0;
      background: var(--header-bg);
      padding: 8px 12px;
      border-color: var(--border-color);
    }
    header { border-bottom: 1px solid var(--border-color); }
    footer { border-top: 1px solid var(--border-color); }

    .control-group, footer {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
    }
    
    .control-group:first-child { margin-bottom: 8px; }

    main {
      display: flex;
      flex: 1;
      min-height: 0;
    }
    main.vertical { flex-direction: column; }

    /* Controls Styling */
    label { font-size: 0.8rem; font-weight: 600; }
    select, button, input[type="text"] {
      font-size: 0.8rem;
      padding: 4px 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      background-color: var(--button-bg);
      transition: background-color 0.2s ease, border-color 0.2s ease;
    }
    button { cursor: pointer; }
    button:hover { background-color: var(--button-hover-bg); }
    button.toggle.active {
      background-color: var(--accent-color);
      color: white;
      border-color: var(--accent-color);
    }

    .control-group-right { margin-left: auto; display: flex; align-items: center; gap: 8px;}
    #editorSizeInput { vertical-align: middle; }
    
    #replaceBar {
        border-top: 1px solid var(--border-color);
        padding-top: 8px;
    }

    #editorWrapper, #previewerWrapper {
      position: relative;
      flex: 1;
      display: flex;
    }
    #previewerWrapper { border-left: 1px solid var(--border-color); }
    main.vertical #previewerWrapper { border-left: 0; border-top: 1px solid var(--border-color); }

    .CodeMirror {
      position: absolute;
      width: 100%;
      height: 100%;
      font-family: 'Fira Code', 'Courier New', monospace;
      font-size: 14px;
    }
    
    iframe {
      width: 100%;
      height: 100%;
      border: 0;
      background: #fff;
    }

    footer { justify-content: space-between; font-size: 0.75rem; }
    .footer-section { display: flex; align-items: center; gap: 8px; }
    .footer-section img { opacity: 0.7; transition: opacity 0.2s ease; }
    .footer-section a:hover img { opacity: 1; }
    
    .hidden { display: none !important; }
    .number { font-family: monospace; }
  </style>
</head>
<body>

  <header>
    <div class="control-group">
      <a href="#" id="downloadLink" title="Download HTML File"><button>Download</button></a>
      <button id="fileInputTrigger">Open File</button>
      <input type="file" accept="text/html" id="fileInput" class="hidden">
      
      <label for="fontSizeSelector">Font</label>
      <select id="fontSizeSelector">
        <option>12</option><option>13</option><option selected>14</option><option>16</option><option>18</option>
      </select>
      
      <label for="previewSelector">Preview</label>
      <select id="previewSelector">
        <option>Instant</option>
        <optgroup label="Delayed">
          <option value="500" selected>0.5s</option><option value="1000">1.0s</option><option value="2000">2.0s</option>
        </optgroup>
        <option>Manual</option>
      </select>
      <button id="runButton">Run</button>
      <button id="resetButton">Reset</button>

      <div class="control-group-right">
        <label for="editorSizeInput">Editor Size</label>
        <input type="range" id="editorSizeInput" min="10" max="90" value="50">
        <button type="button" class="toggle" id="verticalViewToggle">Vertical</button>
        <button type="button" class="toggle active" id="darkEditorToggle">Dark Mode</button>
        <button type="button" class="toggle" id="replaceBarToggle">Find/Replace</button>
      </div>
    </div>
    <div id="replaceBar" class="control-group hidden">
        <!-- This bar is now a placeholder; CodeMirror's dialogs will be used -->
        <p style="margin:0; font-size:0.8rem;">Use <b>Ctrl+F</b> (Find) and <b>Ctrl+Shift+F</b> (Replace) inside the editor.</p>
    </div>
  </header>

  <main>
    <div id="editorWrapper">
      <textarea id="editor"><!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HTML Document Template</title>
  <style>
    body { font-family: sans-serif; line-height: 1.6; padding: 20px; }
    h1 { color: #333; }
  </style>
</head>
<body>
  <h1>Hello, world!</h1>
  <p>This is your real-time HTML editor.</p>
  <script>
    console.log("Welcome to the editor!");
  </script>
</body>
</html></textarea>
    </div>
    <div id="previewerWrapper">
      <iframe></iframe>
    </div>
  </main>

  <footer>
    <div class="footer-section" id="docMetrics">
      <span class="number" id="characterCount">0</span> characters | <span class="number" id="byteCount">0</span> bytes
    </div>
    <div class="footer-section">
      <span>Share:</span>
      <a href="https://x.com/intent/post?text=Check%20out%20this%20awesome%20Online%20HTML%20Editor&url=https%3A%2F%2Fhtmleditor.gitlab.io" target="_blank" title="Share on X"><img src="https://simpleicons.org/icons/x.svg" alt="X"></a>
      <a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fhtmleditor.gitlab.io" target="_blank" title="Share on Facebook"><img src="https://simpleicons.org/icons/facebook.svg" alt="Facebook"></a>
      <a href="#" id="copyButton" title="Copy Link"><img src="https://simpleicons.org/icons/link.svg" alt="Link"></a>
      <output id="copyNotification"></output>
    </div>
  </footer>
  
  <!-- CodeMirror JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/xml/xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/css/css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/closetag.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/search/search.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/search/searchcursor.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/search/jump-to-line.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/dialog/dialog.min.js"></script>

  <script>
    // Encapsulate the entire application in an IIFE to avoid polluting the global scope.
    (function() {
      "use strict";

      const App = {
        // Application Configuration
        config: {
          localStorageKey: 'htmlProEditorState',
          defaultContent: document.getElementById('editor').value,
          numberFormat: new Intl.NumberFormat(),
        },

        // UI Element References
        ui: {},

        // Application State
        editor: null,
        debounceTimeout: null,

        // Initialization
        init() {
          this.bindUIElements();
          this.initEditor();
          this.loadState();
          this.bindEventListeners();
          this.updateUI();
        },

        bindUIElements() {
            const ids = [
                'downloadLink', 'fileInputTrigger', 'fileInput', 'fontSizeSelector', 'previewSelector',
                'runButton', 'resetButton', 'editorSizeInput', 'verticalViewToggle',
                'darkEditorToggle', 'replaceBarToggle', 'replaceBar', 'editorWrapper', 'previewerWrapper',
                'characterCount', 'byteCount', 'copyButton', 'copyNotification'
            ];
            ids.forEach(id => this.ui[id] = document.getElementById(id));
            this.ui.main = document.querySelector('main');
            this.ui.previewer = document.querySelector('iframe');
        },

        initEditor() {
          this.editor = CodeMirror.fromTextArea(document.getElementById('editor'), {
            lineNumbers: true,
            mode: 'htmlmixed',
            theme: 'monokai',
            autoCloseTags: true,
            extraKeys: {"Ctrl-Space": "autocomplete"},
          });
        },

        bindEventListeners() {
          // Editor changes
          this.editor.on('change', () => this.methods.dispatchPreviewUpdate());
          
          // Header controls
          this.ui.downloadLink.addEventListener('click', () => this.methods.createDownloadURL());
          this.ui.fileInputTrigger.addEventListener('click', () => this.ui.fileInput.click());
          this.ui.fileInput.addEventListener('change', (e) => this.methods.handleFileOpen(e));
          this.ui.fontSizeSelector.addEventListener('change', () => this.methods.resizeFont());
          this.ui.previewSelector.addEventListener('change', () => this.methods.dispatchPreviewUpdate(true));
          this.ui.runButton.addEventListener('click', () => this.methods.preview());
          this.ui.resetButton.addEventListener('click', () => this.methods.resetContent());
          this.ui.editorSizeInput.addEventListener('input', () => this.methods.resizePanes());

          // Toggle buttons
          this.ui.verticalViewToggle.addEventListener('click', (e) => this.methods.toggleActive(e.target, 'vertical'));
          this.ui.darkEditorToggle.addEventListener('click', (e) => this.methods.toggleActive(e.target, 'theme'));
          this.ui.replaceBarToggle.addEventListener('click', (e) => this.methods.toggleActive(e.target, 'replace'));
          
          // Footer controls
          this.ui.copyButton.addEventListener('click', () => this.methods.copyLink());

          // Save state on page leave
          window.addEventListener('beforeunload', () => this.saveState());
        },

        // Core Methods
        methods: {
          preview() {
            App.ui.previewer.srcdoc = App.editor.getValue();
            this.updateDocumentMetrics();
          },

          dispatchPreviewUpdate(forceUpdate = false) {
            clearTimeout(App.debounceTimeout);
            const mode = App.ui.previewSelector.value;
            if (mode === 'Instant' || forceUpdate) {
              this.preview();
            } else if (mode !== 'Manual') {
              App.debounceTimeout = setTimeout(() => this.preview(), parseInt(mode, 10));
            }
          },
          
          updateDocumentMetrics() {
            const content = App.editor.getValue();
            const charCount = content.length;
            const byteCount = new Blob([content]).size;
            const format = App.config.numberFormat.format;
            
            App.ui.characterCount.textContent = format(charCount);
            App.ui.byteCount.textContent = format(byteCount);
          },

          createDownloadURL() {
            const blob = new Blob([App.editor.getValue()], { type: 'text/html; charset=utf-8' });
            App.ui.downloadLink.href = URL.createObjectURL(blob);
            App.ui.downloadLink.download = 'index.html';
          },

          async handleFileOpen(event) {
            const file = event.target.files[0];
            if (!file) return;
            try {
              const text = await file.text();
              App.editor.setValue(text);
            } catch (err) {
              console.error("Error reading file:", err);
              alert("Could not read the selected file.");
            }
            event.target.value = ''; // Reset for next open
          },

          resetContent() {
            if (confirm('Are you sure you want to reset the editor content?')) {
              App.editor.setValue(App.config.defaultContent);
            }
          },

          resizeFont() {
            const size = App.ui.fontSizeSelector.value + 'px';
            App.editor.getWrapperElement().style.fontSize = size;
            App.editor.refresh();
          },
          
          resizePanes() {
            const editorSize = App.ui.editorSizeInput.value;
            App.ui.editorWrapper.style.flexGrow = editorSize;
            App.ui.previewerWrapper.style.flexGrow = 100 - editorSize;
          },

          toggleActive(button, type) {
            button.classList.toggle('active');
            App.updateUI();
          },

          copyLink() {
            navigator.clipboard.writeText(location.href).then(() => {
                App.ui.copyNotification.textContent = 'Copied!';
                setTimeout(() => App.ui.copyNotification.textContent = '', 2000);
            });
          }
        },

        // UI Update Logic
        updateUI() {
          // Theme
          const isDark = this.ui.darkEditorToggle.classList.contains('active');
          this.editor.setOption('theme', isDark ? 'monokai' : 'default');

          // Layout
          const isVertical = this.ui.verticalViewToggle.classList.contains('active');
          this.ui.main.classList.toggle('vertical', isVertical);

          // Find/Replace Bar (now just a hint)
          const showReplace = this.ui.replaceBarToggle.classList.contains('active');
          this.ui.replaceBar.classList.toggle('hidden', !showReplace);

          // Refresh editor to adapt to layout changes
          this.editor.refresh();
          this.methods.dispatchPreviewUpdate(true);
        },

        // State Management
        saveState() {
          const state = {
            content: this.editor.getValue(),
            fontSize: this.ui.fontSizeSelector.value,
            previewMode: this.ui.previewSelector.value,
            editorSize: this.ui.editorSizeInput.value,
            isVertical: this.ui.verticalViewToggle.classList.contains('active'),
            isDark: this.ui.darkEditorToggle.classList.contains('active'),
            isReplaceVisible: this.ui.replaceBarToggle.classList.contains('active'),
          };
          localStorage.setItem(this.config.localStorageKey, JSON.stringify(state));
        },

        loadState() {
          const savedState = localStorage.getItem(this.config.localStorageKey);
          if (!savedState) return;

          try {
            const state = JSON.parse(savedState);
            this.editor.setValue(state.content || this.config.defaultContent);
            this.ui.fontSizeSelector.value = state.fontSize || '14';
            this.ui.previewSelector.value = state.previewMode || '500';
            this.ui.editorSizeInput.value = state.editorSize || '50';
            this.ui.verticalViewToggle.classList.toggle('active', state.isVertical || false);
            this.ui.darkEditorToggle.classList.toggle('active', state.isDark !== false); // Default to dark
            this.ui.replaceBarToggle.classList.toggle('active', state.isReplaceVisible || false);
          } catch (e) {
            console.error("Failed to load state from localStorage", e);
            localStorage.removeItem(this.config.localStorageKey);
          }
        }
      };

      // Start the application
      App.init();

    })();
  </script>
</body>
</html>

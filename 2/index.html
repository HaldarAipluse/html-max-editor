<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A fully optimized HTML playground with a responsive UI, built-in console, and professional features for desktop and mobile.">
  <title>HTML Pro Editor</title>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/monokai.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/dracula.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/material-darker.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/eclipse.min.css">

  <style>
    :root {
      --bg-color: #d4d4d4; --border-light: #f0f0f0; --border-dark: #8c8c8c;
      --text-color: #333; --button-bg: #e0e0e0;
      --font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
    html, body {
      height: 100%; padding: 0; margin: 0; font-family: var(--font-family);
      color: var(--text-color); overflow: hidden; background-color: var(--bg-color);
    }
    body { display: flex; flex-direction: column; }
    
    .panel-3d {
      border: 1px solid; border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
      box-shadow: inset 1px 1px 3px rgba(0,0,0,0.2); background: var(--bg-color);
    }
    header { flex-shrink: 0; padding: 8px 12px; border-bottom: 1px solid var(--border-light); }
    nav { display: flex; align-items: center; justify-content: space-between; }
    .control-group { display: flex; flex-wrap: wrap; align-items: center; gap: 8px; }
    .control-separator { border-left: 1px solid var(--border-dark); border-right: 1px solid var(--border-light); margin: 0 4px; height: 24px; }
    main { display: flex; flex-direction: column; flex: 1; min-height: 0; padding: 8px; gap: 8px; }
    #editor-area { display: flex; flex: 1; min-height: 0; gap: 8px; }
    
    button {
      display: inline-flex; align-items: center; justify-content: center; padding: 6px 12px;
      font-size: 1rem; cursor: pointer; color: var(--text-color); background: var(--button-bg);
      border: 1px solid; border-color: var(--border-light) var(--border-dark) var(--border-dark) var(--border-light);
      box-shadow: 1px 1px 2px rgba(0,0,0,0.2); transition: all 0.1s ease-out; position: relative;
    }
    button:active, button.toggle.active {
      border-color: var(--border-dark) var(--border-light) var(--border-light) var(--border-dark);
      box-shadow: inset 1px 1px 2px rgba(0,0,0,0.2); transform: translateY(1px);
    }
    label { font-size: 0.8rem; font-weight: 600; padding-left: 5px; }
    select {
      font-size: 0.8rem; padding: 5px 8px; border: 1px solid var(--border-dark);
      box-shadow: inset 1px 1px 2px rgba(0,0,0,0.2); background-color: #fff;
    }
    
    #editorWrapper, #previewerWrapper { position: relative; flex: 1; display: flex; }
    .CodeMirror { width: 100%; height: 100%; font-family: 'Fira Code', 'Courier New', monospace; }
    iframe { width: 100%; height: 100%; border: 0; background: #fff; }
    
    #console-area { flex-shrink: 0; display: flex; flex-direction: column; height: 150px; }
    #console-header {
      padding: 4px 8px; font-weight: bold; font-size: 0.8rem; display: flex;
      justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-dark);
    }
    #console-output { flex-grow: 1; overflow-y: auto; padding: 5px; font-family: monospace; font-size: 0.8rem; background: #fff; }
    .log-error { color: red; } .log-warn { color: orange; }

    #menu-toggle { display: none; }
    
    @media (max-width: 768px) {
      nav > .control-group { display: none; }
      #menu-toggle { display: inline-flex; }
      #mobile-menu {
        position: fixed; top: 0; right: 0; width: 250px; height: 100%;
        background: var(--bg-color); z-index: 100; transform: translateX(100%);
        transition: transform 0.3s ease-in-out; border-left: 1px solid var(--border-dark);
        padding: 20px; box-shadow: -5px 0 15px rgba(0,0,0,0.2);
      }
      #mobile-menu.open { transform: translateX(0); }
      #mobile-menu .control-group { flex-direction: column; align-items: stretch; gap: 15px; }
      #mobile-menu .control-group .control-separator { display: none; }
      #mobile-menu-close { position: absolute; top: 10px; right: 10px; font-size: 1.5rem; }
      #editor-area { flex-direction: column; }
    }
  </style>
</head>
<body>

  <header class="panel-3d">
    <nav>
      <div class="control-group"> <!-- Desktop Menu -->
        <button id="downloadLink-d" title="Download"><i class="bi bi-download"></i></button>
        <button id="fileInputTrigger-d" title="Open"><i class="bi bi-folder2-open"></i></button>
        <div class="control-separator"></div>
        <button id="runButton-d" title="Run"><i class="bi bi-play-fill"></i></button>
        <button id="resetButton-d" title="Reset"><i class="bi bi-arrow-counterclockwise"></i></button>
        <button id="tidyButton-d" title="Format Code"><i class="bi bi-stars"></i></button>
        <button id="copyButton-d" title="Copy"><i class="bi bi-clipboard"></i></button>
        <div class="control-separator"></div>
        <label for="themeSelector-d">Theme</label> <select id="themeSelector-d"></select>
        <label for="fontSizeSelector-d">Font</label> <select id="fontSizeSelector-d"></select>
        <button id="helpButton-d" title="Help"><i class="bi bi-question-circle"></i></button>
      </div>
      <button id="menu-toggle" title="Menu"><i class="bi bi-list"></i></button>
    </nav>
  </header>
  
  <div id="mobile-menu" class="panel-3d">
      <button id="mobile-menu-close">&times;</button>
      <div class="control-group"> <!-- Mobile Menu Content -->
        <button id="downloadLink-m" title="Download"><i class="bi bi-download"></i> Download</button>
        <button id="fileInputTrigger-m" title="Open"><i class="bi bi-folder2-open"></i> Open</button>
        <button id="runButton-m" title="Run"><i class="bi bi-play-fill"></i> Run</button>
        <button id="resetButton-m" title="Reset"><i class="bi bi-arrow-counterclockwise"></i> Reset</button>
        <button id="tidyButton-m" title="Format Code"><i class="bi bi-stars"></i> Format</button>
        <button id="copyButton-m" title="Copy"><i class="bi bi-clipboard"></i> Copy</button>
        <div><label for="themeSelector-m">Theme</label> <select id="themeSelector-m"></select></div>
        <div><label for="fontSizeSelector-m">Font</label> <select id="fontSizeSelector-m"></select></div>
        <button id="helpButton-m" title="Help"><i class="bi bi-question-circle"></i> Help</button>
      </div>
  </div>

  <main>
    <div id="editor-area">
      <div id="editorWrapper" class="panel-3d"> <textarea id="editor"></textarea> </div>
      <div id="previewerWrapper" class="panel-3d"> <iframe></iframe> </div>
    </div>
    <div id="console-area" class="panel-3d">
      <div id="console-header">
        <span>Console</span>
        <div>
            <button id="clearConsoleButton" title="Clear Console" style="padding: 2px 6px; font-size: 0.8rem;"><i class="bi bi-x-circle"></i> Clear</button>
            <button id="toggleConsoleButton" title="Toggle Console" style="padding: 2px 6px; font-size: 0.8rem;"><i class="bi bi-chevron-down"></i></button>
        </div>
      </div>
      <div id="console-output"></div>
    </div>
  </main>

  <div id="modal-overlay" style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center;">
    <div id="modal" style="background: var(--bg-color); padding: 20px; border-radius: 8px; max-width: 400px;" class="panel-3d">
      <h2 style="margin-top:0;">Keyboard Shortcuts</h2>
      <p><b>Find:</b> <kbd>Ctrl</kbd> + <kbd>F</kbd></p>
      <p><b>Replace:</b> <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>F</kbd></p>
      <p><b>Download:</b> <kbd>Ctrl</kbd> + <kbd>S</kbd></p>
      <button id="modal-close" style="width:100%; margin-top: 15px;">Close</button>
    </div>
  </div>
  
  <div id="toast" style="position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background-color: #2c3e50; color: white; padding: 12px 20px; border-radius: 6px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: bottom 0.5s ease-in-out; z-index: 1000;"></div>
  
  <input type="file" accept="text/html" id="fileInput" style="display:none;">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.11/beautify-html.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/closetag.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/dialog/dialog.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/search/search.min.js"></script>

  <script>
    (function() {
      "use strict";
      const App = {
        config: {
          localStorageKey: 'htmlProEditorState_v4',
          defaultContent: `<!doctype html>
<html>
  <head>
    <title>Hello!</title>
    <style>body{font-family:sans-serif;}</style>
  </head>
  <body>
    <h1>Optimized for All Devices</h1>
    <p>This editor works great on desktop and mobile.</p>
    <script>
      console.log("Welcome! This is a log message.");
      console.warn("This is a warning.");
      console.error("This is an error.");
    <\/script>
  </body>
</html>`,
        },
        ui: {}, editor: null, debounceTimeout: null,

        init() {
          this.populateSelectors(); this.bindUIElements(); this.initEditor();
          this.loadState(); this.bindEventListeners(); this.updateUI();
        },
        
        populateSelectors() {
            const themes = { monokai: "Monokai", dracula: "Dracula", 'material-darker': "Material", eclipse: "Eclipse (Light)" };
            const fontSizes = [12, 14, 16, 18];
            ['d', 'm'].forEach(suffix => {
                const themeSel = document.getElementById(`themeSelector-${suffix}`);
                Object.entries(themes).forEach(([val, text]) => themeSel.add(new Option(text, val)));
                const fontSel = document.getElementById(`fontSizeSelector-${suffix}`);
                fontSizes.forEach(size => fontSel.add(new Option(size, size)));
            });
        },

        bindUIElements() {
          const ids = [
            'editorWrapper', 'previewerWrapper', 'console-area', 'console-output', 'clearConsoleButton', 'toggleConsoleButton',
            'menu-toggle', 'mobile-menu', 'mobile-menu-close', 'modal-overlay', 'modal-close', 'toast', 'fileInput'
          ];
          ids.forEach(id => this.ui[id] = document.getElementById(id));
          ['d', 'm'].forEach(s => {
              ['downloadLink', 'fileInputTrigger', 'runButton', 'resetButton', 'tidyButton', 'copyButton', 'helpButton', 'themeSelector', 'fontSizeSelector'].forEach(c => {
                  this.ui[`${c}-${s}`] = document.getElementById(`${c}-${s}`);
              });
          });
          this.ui.main = document.querySelector('main');
          this.ui.previewer = document.querySelector('iframe');
        },

        initEditor() {
          const editorNode = document.getElementById('editor');
          editorNode.value = this.config.defaultContent;
          this.editor = CodeMirror.fromTextArea(editorNode, {
            lineNumbers: true, mode: 'htmlmixed', theme: 'monokai', autoCloseTags: true,
          });
        },

        bindEventListeners() {
          this.editor.on('change', () => this.methods.dispatchPreviewUpdate());
          
          const attachListeners = (s) => {
              this.ui[`downloadLink-${s}`].addEventListener('click', (e) => this.methods.createDownloadURL(e));
              this.ui[`fileInputTrigger-${s}`].addEventListener('click', () => this.ui.fileInput.click());
              this.ui[`runButton-${s}`].addEventListener('click', () => this.methods.preview());
              this.ui[`resetButton-${s}`].addEventListener('click', () => this.methods.resetContent());
              this.ui[`tidyButton-${s}`].addEventListener('click', () => this.methods.formatCode());
              this.ui[`copyButton-${s}`].addEventListener('click', () => this.methods.copyEditorContent());
              this.ui[`helpButton-${s}`].addEventListener('click', () => this.methods.openModal());
              this.ui[`themeSelector-${s}`].addEventListener('change', (e) => this.methods.syncAndApply('theme', e.target.value));
              this.ui[`fontSizeSelector-${s}`].addEventListener('change', (e) => this.methods.syncAndApply('font', e.target.value));
          };
          ['d', 'm'].forEach(attachListeners);

          this.ui.fileInput.addEventListener('change', (e) => this.methods.handleFileOpen(e));
          this.ui['menu-toggle'].addEventListener('click', () => this.ui['mobile-menu'].classList.add('open'));
          this.ui['mobile-menu-close'].addEventListener('click', () => this.ui['mobile-menu'].classList.remove('open'));
          this.ui.clearConsoleButton.addEventListener('click', () => this.ui['console-output'].innerHTML = '');
          this.ui.toggleConsoleButton.addEventListener('click', () => this.methods.toggleConsole());
          this.ui['modal-overlay'].addEventListener('click', (e) => e.target === this.ui['modal-overlay'] && this.methods.closeModal());
          this.ui['modal-close'].addEventListener('click', () => this.methods.closeModal());
          
          window.addEventListener('message', (e) => this.methods.handleConsoleLog(e.data));
          document.addEventListener('keydown', (e) => {
              if (e.ctrlKey && e.key.toLowerCase() === 's') { e.preventDefault(); this.methods.createDownloadURL(e); }
          });
          window.addEventListener('beforeunload', () => this.saveState());
        },

        methods: {
          preview() {
            const code = App.editor.getValue();
            const consoleInterceptor = `
              <script>
                const originalConsole = {...window.console};
                Object.keys(originalConsole).forEach(key => {
                  if (typeof originalConsole[key] === 'function') {
                    window.console[key] = (...args) => {
                      originalConsole[key](...args);
                      window.parent.postMessage({ type: key, args: args.map(arg => JSON.stringify(arg, null, 2) || 'undefined') }, '*');
                    };
                  }
                });
              <\/script>
            `;
            App.ui.previewer.srcdoc = code.replace('</head>', `${consoleInterceptor}</head>`);
            this.updateDocumentMetrics();
          },
          dispatchPreviewUpdate() { clearTimeout(App.debounceTimeout); App.debounceTimeout = setTimeout(() => this.preview(), 300); },
          updateDocumentMetrics() { /* Omitted for brevity */ },
          createDownloadURL(e) {
            e.preventDefault();
            const blob = new Blob([App.editor.getValue()], { type: 'text/html; charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'index.html'; a.click();
            URL.revokeObjectURL(url); a.remove();
            this.showToast('Download started...');
          },
          async handleFileOpen(e) {
            const file = e.target.files[0];
            if (file) { try { App.editor.setValue(await file.text()); } catch (err) { alert("Could not read file."); } e.target.value = ''; }
          },
          resetContent() { if (confirm('Reset editor?')) App.editor.setValue(App.config.defaultContent); },
          formatCode() {
            const formatted = html_beautify(App.editor.getValue(), { indent_size: 2 });
            App.editor.setValue(formatted); this.showToast('Code formatted!');
          },
          copyEditorContent() { navigator.clipboard.writeText(App.editor.getValue()).then(() => this.showToast('Copied to Clipboard!')); },
          showToast(message) {
            const toast = App.ui.toast; toast.textContent = message; toast.style.bottom = '20px';
            setTimeout(() => toast.style.bottom = '-100px', 3000);
          },
          openModal() { App.ui['modal-overlay'].style.display = 'flex'; },
          closeModal() { App.ui['modal-overlay'].style.display = 'none'; },
          toggleConsole() {
              App.ui['console-area'].style.height = App.ui['console-area'].style.height === '36px' ? '150px' : '36px';
              App.ui.toggleConsoleButton.firstElementChild.classList.toggle('bi-chevron-up');
              App.ui.toggleConsoleButton.firstElementChild.classList.toggle('bi-chevron-down');
          },
          handleConsoleLog({type, args}) {
              const logEntry = document.createElement('div');
              if (['error', 'warn'].includes(type)) logEntry.className = `log-${type}`;
              logEntry.textContent = `> ${args.join(' ')}`;
              App.ui['console-output'].appendChild(logEntry);
              logEntry.scrollIntoView();
          },
          syncAndApply(type, value) {
              const suffixes = ['d', 'm'];
              const key = type === 'theme' ? 'themeSelector' : 'fontSizeSelector';
              suffixes.forEach(s => App.ui[`${key}-${s}`].value = value);
              this.updateUI();
          }
        },

        updateUI() {
          App.editor.setOption('theme', App.ui['themeSelector-d'].value);
          App.editor.getWrapperElement().style.fontSize = App.ui['fontSizeSelector-d'].value + 'px';
          setTimeout(() => App.editor.refresh(), 10);
        },

        saveState() {
          const state = {
            content: this.editor.getValue(), theme: this.ui['themeSelector-d'].value,
            fontSize: this.ui['fontSizeSelector-d'].value,
          };
          localStorage.setItem(this.config.localStorageKey, JSON.stringify(state));
        },

        loadState() {
          try {
            const state = JSON.parse(localStorage.getItem(this.config.localStorageKey));
            if (!state) throw new Error("No saved state");
            this.editor.setValue(state.content || this.config.defaultContent);
            this.methods.syncAndApply('theme', state.theme || 'monokai');
            this.methods.syncAndApply('font', state.fontSize || '14');
          } catch (e) {}
        }
      };
      App.init();
    })();
  </script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A professional, client-side tool for writing and previewing HTML code with a tactile interface.">
  <title>HTML Pro Editor</title>
  
  <!-- Icon Library: Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  
  <!-- CodeMirror CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/monokai.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/dialog/dialog.min.css">

  <style>
    :root {
      --bg-color: #ececec;
      --border-color: #c5c5c5;
      --shadow-color: #a0a0a0;
      --text-color: #333;
      --button-bg: linear-gradient(to bottom, #fefefe, #f0f0f0);
      --button-active-bg: linear-gradient(to bottom, #e0e0e0, #efefef);
      --font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
    }

    html, body {
      height: 100%;
      padding: 0;
      margin: 0;
      font-family: var(--font-family);
      color: var(--text-color);
      overflow: hidden;
      background-color: var(--bg-color);
    }

    body {
      display: flex;
      flex-direction: column;
    }

    header, footer {
      flex-shrink: 0;
      background: #e0e0e0;
      padding: 8px 12px;
      border-color: var(--border-color);
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    header { border-bottom: 1px solid var(--border-color); }
    footer { border-top: 1px solid var(--border-color); }

    .control-group { display: flex; flex-wrap: wrap; align-items: center; gap: 8px; }
    
    main { display: flex; flex: 1; min-height: 0; }
    main.vertical { flex-direction: column; }

    /* 3D Button Style */
    button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 6px 12px;
      font-size: 1rem; /* For icons */
      cursor: pointer;
      color: var(--text-color);
      background: var(--button-bg);
      border: 1px solid var(--border-color);
      border-bottom: 2px solid var(--shadow-color);
      border-radius: 5px;
      transition: all 0.1s ease-out;
      position: relative;
    }
    button:hover { background: #fff; }
    button:active {
      transform: translateY(1px);
      border-bottom-width: 1px;
      background: var(--button-active-bg);
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.15);
    }

    button.toggle.active {
      transform: translateY(1px);
      border-bottom-width: 1px;
      background: var(--button-active-bg);
      box-shadow: inset 0 2px 3px rgba(0,0,0,0.2);
      color: #0078d4;
    }
    
    label { font-size: 0.8rem; font-weight: 600; padding-left: 5px; }
    select {
      font-size: 0.8rem;
      padding: 5px 8px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      background-color: #fff;
    }

    .control-group-right { margin-left: auto; display: flex; align-items: center; gap: 8px;}
    
    #replaceBar {
        padding: 8px;
        margin-top: 8px;
        border-radius: 5px;
        background: #f1f1f1;
        border: 1px solid var(--border-color);
    }

    #editorWrapper, #previewerWrapper {
      position: relative;
      flex: 1;
      display: flex;
    }
    #previewerWrapper { border-left: 2px solid var(--border-color); }
    main.vertical #previewerWrapper { border-left: 0; border-top: 2px solid var(--border-color); }

    .CodeMirror {
      position: absolute;
      width: 100%;
      height: 100%;
      font-family: 'Fira Code', 'Courier New', monospace;
    }
    
    iframe { width: 100%; height: 100%; border: 0; background: #fff; }

    footer { justify-content: space-between; font-size: 0.75rem; }
    .footer-section { display: flex; align-items: center; gap: 8px; }
    .footer-section a { color: inherit; text-decoration: none; }
    .footer-section a:hover { text-decoration: underline; }
    
    .hidden { display: none !important; }
    .number { font-family: monospace; }
  </style>
</head>
<body>

  <header>
    <div class="control-group">
      <button id="downloadLink" title="Download File"><i class="bi bi-download"></i></button>
      <button id="fileInputTrigger" title="Open File"><i class="bi bi-folder2-open"></i></button>
      <input type="file" accept="text/html" id="fileInput" class="hidden">
      
      <label for="fontSizeSelector">Font</label>
      <select id="fontSizeSelector">
        <option>12</option><option>13</option><option selected>14</option><option>16</option><option>18</option>
      </select>
      
      <label for="previewSelector">Preview</label>
      <select id="previewSelector">
        <option>Instant</option>
        <optgroup label="Delayed">
          <option value="500" selected>0.5s</option><option value="1000">1.0s</option><option value="2000">2.0s</option>
        </optgroup>
        <option>Manual</option>
      </select>
      <button id="runButton" title="Run Preview"><i class="bi bi-play-fill"></i></button>
      <button id="resetButton" title="Reset Editor"><i class="bi bi-arrow-counterclockwise"></i></button>

      <div class="control-group-right">
        <label for="editorSizeInput">Size</label>
        <input type="range" id="editorSizeInput" min="10" max="90" value="50">
        <button type="button" class="toggle" id="verticalViewToggle" title="Vertical View"><i class="bi bi-distribute-vertical"></i></button>
        <button type="button" class="toggle active" id="darkEditorToggle" title="Dark Mode"><i class="bi bi-moon-stars-fill"></i></button>
        <button type="button" class="toggle" id="replaceBarToggle" title="Find & Replace"><i class="bi bi-search"></i></button>
      </div>
    </div>
    <div id="replaceBar" class="hidden">
        <p style="margin:0; font-size:0.8rem;">Use <b>Ctrl+F</b> (Find) and <b>Ctrl+Shift+F</b> (Replace) inside the editor.</p>
    </div>
  </header>

  <main>
    <div id="editorWrapper">
      <textarea id="editor"><!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HTML Document Template</title>
  <style>
    body { font-family: sans-serif; line-height: 1.6; padding: 20px; }
    h1 { color: #333; }
  </style>
</head>
<body>
  <h1>Hello, world!</h1>
  <p>This is your real-time HTML editor.</p>
  <script>
    console.log("Welcome to the editor!");
  </script>
</body>
</html></textarea>
    </div>
    <div id="previewerWrapper">
      <iframe></iframe>
    </div>
  </main>

  <footer>
    <div class="footer-section" id="docMetrics">
      <span class="number" id="characterCount">0</span> characters | <span class="number" id="byteCount">0</span> bytes
    </div>
    <div class="footer-section">
      <a href="#" id="copyButton" title="Copy Link"><i class="bi bi-link-45deg" style="font-size: 1.2rem;"></i></a>
      <output id="copyNotification"></output>
       | Created by <a href="https://tzproapks.blogspot.com/" rel="author">tzproapks</a>
    </div>
  </footer>
  
  <!-- CodeMirror JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/xml/xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/css/css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/closetag.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/search/search.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/search/searchcursor.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/search/jump-to-line.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/dialog/dialog.min.js"></script>

  <script>
    (function() {
      "use strict";

      const App = {
        config: {
          localStorageKey: 'htmlProEditorState',
          defaultContent: document.getElementById('editor').value,
          numberFormat: new Intl.NumberFormat(),
        },
        ui: {},
        editor: null,
        debounceTimeout: null,

        init() {
          this.bindUIElements();
          this.initEditor();
          this.loadState();
          this.bindEventListeners();
          this.updateUI(); // Initial UI sync based on loaded state
        },

        bindUIElements() {
            const ids = [
                'downloadLink', 'fileInputTrigger', 'fileInput', 'fontSizeSelector', 'previewSelector',
                'runButton', 'resetButton', 'editorSizeInput', 'verticalViewToggle',
                'darkEditorToggle', 'replaceBarToggle', 'replaceBar', 'editorWrapper', 'previewerWrapper',
                'characterCount', 'byteCount', 'copyButton', 'copyNotification'
            ];
            ids.forEach(id => this.ui[id] = document.getElementById(id));
            this.ui.main = document.querySelector('main');
            this.ui.previewer = document.querySelector('iframe');
        },

        initEditor() {
          this.editor = CodeMirror.fromTextArea(document.getElementById('editor'), {
            lineNumbers: true,
            mode: 'htmlmixed',
            theme: 'monokai',
            autoCloseTags: true,
          });
        },

        bindEventListeners() {
          this.editor.on('change', () => this.methods.dispatchPreviewUpdate());
          
          this.ui.downloadLink.addEventListener('click', (e) => this.methods.createDownloadURL(e));
          this.ui.fileInputTrigger.addEventListener('click', () => this.ui.fileInput.click());
          this.ui.fileInput.addEventListener('change', (e) => this.methods.handleFileOpen(e));
          this.ui.fontSizeSelector.addEventListener('change', () => this.methods.resizeFont());
          this.ui.previewSelector.addEventListener('change', () => this.methods.dispatchPreviewUpdate(true));
          this.ui.runButton.addEventListener('click', () => this.methods.preview());
          this.ui.resetButton.addEventListener('click', () => this.methods.resetContent());
          this.ui.editorSizeInput.addEventListener('input', () => this.methods.resizePanes());

          // Toggle buttons trigger a full UI update
          ['verticalViewToggle', 'darkEditorToggle', 'replaceBarToggle'].forEach(id => {
              this.ui[id].addEventListener('click', (e) => {
                  e.currentTarget.classList.toggle('active');
                  this.updateUI();
              });
          });
          
          this.ui.copyButton.addEventListener('click', (e) => { e.preventDefault(); this.methods.copyLink(); });
          window.addEventListener('beforeunload', () => this.saveState());
        },

        methods: {
          preview() {
            App.ui.previewer.srcdoc = App.editor.getValue();
            this.updateDocumentMetrics();
          },
          dispatchPreviewUpdate(forceUpdate = false) {
            clearTimeout(App.debounceTimeout);
            const mode = App.ui.previewSelector.value;
            if (mode === 'Instant' || forceUpdate) {
              this.preview();
            } else if (mode !== 'Manual') {
              App.debounceTimeout = setTimeout(() => this.preview(), parseInt(mode, 10));
            }
          },
          updateDocumentMetrics() {
            const content = App.editor.getValue();
            const charCount = content.length;
            const byteCount = new Blob([content]).size;
            App.ui.characterCount.textContent = App.config.numberFormat.format(charCount);
            App.ui.byteCount.textContent = App.config.numberFormat.format(byteCount);
          },
          createDownloadURL(event) {
            event.preventDefault(); // Prevent navigation
            const blob = new Blob([App.editor.getValue()], { type: 'text/html; charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'index.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          },
          async handleFileOpen(event) {
            const file = event.target.files[0];
            if (!file) return;
            try { App.editor.setValue(await file.text()); } 
            catch (err) { alert("Could not read the selected file."); }
            event.target.value = '';
          },
          resetContent() {
            if (confirm('Are you sure you want to reset the editor content?')) {
              App.editor.setValue(App.config.defaultContent);
            }
          },
          resizeFont() {
            App.editor.getWrapperElement().style.fontSize = App.ui.fontSizeSelector.value + 'px';
            App.editor.refresh();
          },
          resizePanes() {
            const size = App.ui.editorSizeInput.value;
            App.ui.editorWrapper.style.flexGrow = size;
            App.ui.previewerWrapper.style.flexGrow = 100 - size;
          },
          copyLink() {
            navigator.clipboard.writeText(location.href).then(() => {
                App.ui.copyNotification.textContent = 'Copied!';
                setTimeout(() => App.ui.copyNotification.textContent = '', 2000);
            });
          }
        },

        updateUI() {
          const isDark = this.ui.darkEditorToggle.classList.contains('active');
          this.editor.setOption('theme', isDark ? 'monokai' : 'default');

          const isVertical = this.ui.verticalViewToggle.classList.contains('active');
          this.ui.main.classList.toggle('vertical', isVertical);

          const showReplace = this.ui.replaceBarToggle.classList.contains('active');
          this.ui.replaceBar.classList.toggle('hidden', !showReplace);
          
          this.methods.resizeFont();
          this.methods.resizePanes();
          this.editor.refresh();
          this.methods.dispatchPreviewUpdate(true);
        },

        saveState() {
          const state = {
            content: this.editor.getValue(),
            fontSize: this.ui.fontSizeSelector.value,
            previewMode: this.ui.previewSelector.value,
            editorSize: this.ui.editorSizeInput.value,
            isVertical: this.ui.verticalViewToggle.classList.contains('active'),
            isDark: this.ui.darkEditorToggle.classList.contains('active'),
            isReplaceVisible: this.ui.replaceBarToggle.classList.contains('active'),
          };
          localStorage.setItem(this.config.localStorageKey, JSON.stringify(state));
        },

        loadState() {
          const savedState = localStorage.getItem(this.config.localStorageKey);
          if (!savedState) return;
          try {
            const state = JSON.parse(savedState);
            this.editor.setValue(state.content || this.config.defaultContent);
            this.ui.fontSizeSelector.value = state.fontSize || '14';
            this.ui.previewSelector.value = state.previewMode || '500';
            this.ui.editorSizeInput.value = state.editorSize || '50';
            this.ui.verticalViewToggle.classList.toggle('active', state.isVertical || false);
            this.ui.darkEditorToggle.classList.toggle('active', state.isDark !== false);
            this.ui.replaceBarToggle.classList.toggle('active', state.isReplaceVisible || false);
          } catch (e) {
            localStorage.removeItem(this.config.localStorageKey);
          }
        }
      };

      App.init();
    })();
  </script>
</body>
</html>
